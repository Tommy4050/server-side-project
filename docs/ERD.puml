@startuml
' Webshop + social features ER diagram (crow's foot)
' Copy into any PlantUML renderer

hide methods
skinparam linetype ortho
left to right direction

entity "User" as User {
  *user_id : INT <<PK>>
  --
  username : VARCHAR(50) <<UNIQUE>>
  email : VARCHAR(255) <<UNIQUE>>
  password_hash : VARCHAR(255)
  created_at : DATETIME
  status : ENUM('active','suspended','deleted')
  -- billing (current default)
  billing_full_name : VARCHAR(100)
  billing_address1 : VARCHAR(150)
  billing_address2 : VARCHAR(150)
  billing_city : VARCHAR(100)
  billing_postal_code : VARCHAR(20)
  billing_country : VARCHAR(2)
}

entity "Role" as Role {
  *role_id : INT <<PK>>
  name : ENUM('admin','user') <<UNIQUE>>
}

entity "UserRole" as UserRole {
  *user_id : INT <<PK,FK>>
  *role_id : INT <<PK,FK>>
  assigned_at : DATETIME
}

entity "Game" as Game {
  *game_id : INT <<PK>>
  title : VARCHAR(150) <<UNIQUE>>
  description : TEXT
  price : DECIMAL(10,2)
  image_url : VARCHAR(255)
  publisher : VARCHAR(120)
  release_date : DATE
  is_published : BOOLEAN
  created_at : DATETIME
  updated_at : DATETIME
}

entity "Genre" as Genre {
  *genre_id : INT <<PK>>
  name : VARCHAR(50) <<UNIQUE>>
}

entity "GameGenre" as GameGenre {
  *game_id : INT <<PK,FK>>
  *genre_id : INT <<PK,FK>>
}

entity "ShoppingCart" as Cart {
  *cart_id : INT <<PK>>
  user_id : INT <<FK>>
  status : ENUM('active','abandoned','converted')
  created_at : DATETIME
  updated_at : DATETIME
}

entity "CartItem" as CartItem {
  *cart_item_id : INT <<PK>>
  cart_id : INT <<FK>>
  game_id : INT <<FK>>
  quantity : INT
  unit_price_at_add : DECIMAL(10,2)
  added_at : DATETIME
}

entity "Order" as Order {
  *order_id : INT <<PK>>
  user_id : INT <<FK>>
  status : ENUM('pending','paid','failed','refunded','cancelled')
  total_amount : DECIMAL(10,2)
  placed_at : DATETIME
  payment_method : ENUM('card','paypal','other')
  -- snapshot billing details
  bill_full_name : VARCHAR(100)
  bill_address1 : VARCHAR(150)
  bill_address2 : VARCHAR(150)
  bill_city : VARCHAR(100)
  bill_postal_code : VARCHAR(20)
  bill_country : VARCHAR(2)
}

entity "OrderItem" as OrderItem {
  *order_item_id : INT <<PK>>
  order_id : INT <<FK>>
  game_id : INT <<FK>>
  quantity : INT
  unit_price : DECIMAL(10,2)
}

entity "UserLibrary" as Library {
  *user_id : INT <<PK,FK>>
  *game_id : INT <<PK,FK>>
  acquired_at : DATETIME
  source : ENUM('purchase','gift','admin_grant')
}

entity "Post (Screenshot)" as Post {
  *post_id : INT <<PK>>
  user_id : INT <<FK>>
  game_id : INT <<FK>>
  caption : VARCHAR(500)
  image_path : VARCHAR(255)
  visibility : ENUM('public','friends','private')
  created_at : DATETIME
  updated_at : DATETIME
  is_removed : BOOLEAN
}

entity "Comment" as Comment {
  *comment_id : INT <<PK>>
  post_id : INT <<FK>>
  user_id : INT <<FK>>
  body : VARCHAR(1000)
  created_at : DATETIME
  is_removed : BOOLEAN
}

entity "Like" as Like {
  *post_id : INT <<PK,FK>>
  *user_id : INT <<PK,FK>>
  liked_at : DATETIME
}

entity "Friendship" as Friendship {
  *user_id : INT <<PK,FK>>
  *friend_user_id : INT <<PK,FK>>
  status : ENUM('pending','accepted','blocked')
  requested_at : DATETIME
  responded_at : DATETIME
}

entity "ModerationAction" as ModAction {
  *action_id : INT <<PK>>
  admin_user_id : INT <<FK>>
  target_post_id : INT <<FK>>
  target_comment_id : INT <<FK>>
  target_user_id : INT <<FK>>
  action_type : ENUM('remove_post','remove_comment','suspend_user','unsuspend_user')
  reason : VARCHAR(500)
  created_at : DATETIME
}

entity "GameAdminAction" as GameAction {
  *action_id : INT <<PK>>
  admin_user_id : INT <<FK>>
  game_id : INT <<FK>>
  action_type : ENUM('create','update','delete','publish','unpublish')
  notes : VARCHAR(500)
  created_at : DATETIME
}

' =====================
' Relationships (crow's foot)
' =====================
User ||--o{ UserRole : has
Role ||--o{ UserRole : includes

User ||--o{ Cart : owns
Cart ||--o{ CartItem : contains
Game ||--o{ CartItem : is

User ||--o{ Order : places
Order ||--o{ OrderItem : has
Game ||--o{ OrderItem : purchased

User ||--o{ Library : owns
Game ||--o{ Library : appears in

Game ||--o{ GameGenre : categorized by
Genre ||--o{ GameGenre : categorizes

User ||--o{ Post : creates
Game ||--o{ Post : referenced by
Post ||--o{ Comment : has
User ||--o{ Comment : writes
Post ||--o{ Like : receives
User ||--o{ Like : gives

User ||--o{ Friendship : user
User ||--o{ Friendship : friend

User ||--o{ ModAction : performed by (admin)
Post ||--o{ ModAction : target post
Comment ||--o{ ModAction : target comment
User ||--o{ ModAction : target user

User ||--o{ GameAction : performed by (admin)
Game ||--o{ GameAction : target game

' =====================
' Legend & Relationship Explanations
' =====================
legend bottom
<b>Crow's Foot jelölés – magyarázat</b>
- <b>||</b> = pontosan egy (kötelező egy)
- <b>o|</b> = nulla vagy egy (opcionális egy)
- <b>|{</b> = egy vagy több (kötelező sok)
- <b>o{</b> = nulla vagy több (opcionális sok)

<b>Kapcsolatok összefoglalója</b>
- <b>User ↔ Role</b>: sok-sok kapcsolat a <i>UserRole</i> táblán keresztül. Egy felhasználónak több szerepe lehet, egy szerep több felhasználóhoz rendelhető.
- <b>User ↔ ShoppingCart</b>: egy felhasználó (||) nulla vagy több (o{) kosarat birtokol. Tipikusan egy aktív kosár, a többi elhagyott/konvertált.
- <b>Cart ↔ CartItem</b>: egy kosár (||) nulla vagy több (o{) tételt tartalmaz; minden tétel pontosan egy játékra hivatkozik.
- <b>Game ↔ CartItem</b>: egy játék (||) nulla vagy több (o{) kosár-tételben szerepelhet.
- <b>User ↔ Order</b>: egy felhasználó (||) nulla vagy több (o{) rendelést ad le.
- <b>Order ↔ OrderItem</b>: egy rendelés (||) egy vagy több (|{) tételt tartalmaz; minden tétel pontosan egy játékra hivatkozik.
- <b>Game ↔ OrderItem</b>: egy játék (||) nulla vagy több (o{) rendelési tételben szerepelhet.
- <b>User ↔ Library</b>: sok-sok kapcsolat felhasználók és játékok között a <i>Library</i> táblán keresztül (tulajdon). Egy felhasználó nulla vagy több játékot birtokolhat; egy játék több könyvtárban is megjelenhet.
- <b>Game ↔ Genre</b>: sok-sok kapcsolat a <i>GameGenre</i> táblán keresztül. Egy játék több műfajú lehet; egy műfaj sok játékot kategorizál.
- <b>User ↔ Post</b>: egy felhasználó (||) nulla vagy több (o{) bejegyzést (screenshot) hoz létre; minden bejegyzés pontosan egy játékhoz kapcsolódik.
- <b>Post ↔ Comment</b>: egy bejegyzés (||) nulla vagy több (o{) kommentet kaphat; minden kommentet pontosan egy felhasználó ír.
- <b>Post ↔ Like</b>: egy bejegyzés (||) nulla vagy több (o{) lájkot kap; minden lájkot pontosan egy felhasználó ad (összetett PK megakadályozza a duplikációt).
- <b>User ↔ Friendship</b>: önhivatkozó sok-sok kapcsolat két idegen kulccsal. Minden sor egy ismerős-kérés/kant (állapot: pending/accepted/blocked).
- <b>ModerationAction</b>: admin felhasználó hajtja végre egy célon (post/comment/user). Naplózza a moderációs eseményeket.
- <b>GameAdminAction</b>: admin felhasználó művelete a játékon (create/update/delete/publish/unpublish) – audit célokra.
endlegend

@enduml
